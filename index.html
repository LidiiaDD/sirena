<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voice ‚Üí Translate ‚Üí Word</title>
<link rel="preconnect" href="https://unpkg.com">
<style>
  :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --accent:#22c55e; --danger:#ef4444; }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0b1020;color:#e5e7eb}
  .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
  .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;background:#1f2937;color:#e5e7eb;cursor:pointer}
  .btn:hover{filter:brightness(1.1)} .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.primary{background:#2563eb} .btn.stop{background:#ef4444}
  .select{padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1224;color:#e5e7eb}
  .pane{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px}
  textarea{width:100%;min-height:200px;background:transparent;border:0;color:#e5e7eb;resize:vertical;font-size:15px;line-height:1.5}
  h1{font-size:22px;margin:0 0 14px 0} h2{font-size:16px;margin:10px 0}
  .status{margin-top:6px;font-size:13px;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:20px;background:#0b1224;border:1px solid #223; font-size:12px}
  .ok{color:var(--accent)} .bad{color:var(--danger)}
</style>
</head>
<body>
<div class="wrap">
  <h1>üéôÔ∏è Voice ‚Üí üåç Translate ‚Üí üìÑ Word</h1>

  <div class="bar">
    <button id="startBtn" class="btn primary">‚ñ∂Ô∏è –ü–æ—á–∞—Ç–∏</button>
    <button id="stopBtn" class="btn stop" disabled>‚èπ –ó—É–ø–∏–Ω–∏—Ç–∏</button>
    <button id="clearBtn" class="btn">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
    <button id="saveBtn" class="btn">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ Word</button>

    <span class="pill" id="asrSupport">ASR: ‚Ä¶</span>
    <span class="pill" id="transSupport">Translate: ‚Ä¶</span>
  </div>

  <div class="bar">
    <label>üó£ –ú–æ–≤–∞ –¥–∏–∫—Ç–æ—Ä–∞:
      <select id="sourceLang" class="select">
        <option value="uk-UA">uk-UA (–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞)</option>
        <option value="ru-RU">ru-RU (–†—É—Å—Å–∫–∏–π)</option>
        <option value="en-US">en-US (English)</option>
        <option value="pl-PL">pl-PL (Polski)</option>
        <option value="de-DE">de-DE (Deutsch)</option>
        <option value="fr-FR">fr-FR (Fran√ßais)</option>
      </select>
    </label>
    <label>üîΩ –ú–æ–≤–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—É:
      <select id="targetLang" class="select">
        <option value="uk">uk</option>
        <option value="en">en</option>
        <option value="pl">pl</option>
        <option value="de">de</option>
        <option value="fr">fr</option>
        <option value="es">es</option>
      </select>
    </label>
  </div>

  <div class="pane">
    <h2>üé§ –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç</h2>
    <textarea id="orig" placeholder="–¢—É—Ç –∑‚Äô—è–≤–ª—è—Ç–∏–º–µ—Ç—å—Å—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç‚Ä¶"></textarea>
  </div>

  <div class="pane" style="margin-top:14px;">
    <h2>üåç –ü–µ—Ä–µ–∫–ª–∞–¥</h2>
    <textarea id="tran" placeholder="–¢—É—Ç –∑‚Äô—è–≤–ª—è—Ç–∏–º–µ—Ç—å—Å—è –ø–µ—Ä–µ–∫–ª–∞–¥‚Ä¶"></textarea>
    <div class="status" id="status">–ì–æ—Ç–æ–≤–æ –¥–æ —Ä–æ–±–æ—Ç–∏</div>
  </div>
</div>

<script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
<script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script>
(() => {
  // ------- CONFIG (translator) -------
  const AZURE_KEY = "";      // optional: your Azure Translator key
  const AZURE_REGION = "";   // e.g. "westeurope"
  const AZURE_ENDPOINT = "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0";
  const LIBRE_URL = "https://libretranslate.com/translate";

  const startBtn = document.getElementById("startBtn");
  const stopBtn  = document.getElementById("stopBtn");
  const clearBtn = document.getElementById("clearBtn");
  const saveBtn  = document.getElementById("saveBtn");
  const sourceSel= document.getElementById("sourceLang");
  const targetSel= document.getElementById("targetLang");
  const orig     = document.getElementById("orig");
  const tran     = document.getElementById("tran");
  const statusEl = document.getElementById("status");
  const asrBadge = document.getElementById("asrSupport");
  const trBadge  = document.getElementById("transSupport");

  const sys = (navigator.language || "uk").split("-")[0];
  [...targetSel.options].some(o => { if (o.value === sys) { targetSel.value = sys; return true; } });

  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  const asrSupported = !!SR;
  asrBadge.textContent = "ASR: " + (asrSupported ? "supported" : "not available");
  asrBadge.classList.add(asrSupported ? "ok" : "bad");
  trBadge.textContent = "Translate: " + (AZURE_KEY ? "Azure" : "Libre (demo)");
  trBadge.classList.add("ok");

  async function translateText(text, to) {
    if (!text.trim()) return "";
    try {
      if (AZURE_KEY) {
        const url = `${AZURE_ENDPOINT}&to=${encodeURIComponent(to)}`;
        const r = await fetch(url, {
          method: "POST",
          headers: {
            "Ocp-Apim-Subscription-Key": AZURE_KEY,
            "Ocp-Apim-Subscription-Region": AZURE_REGION,
            "Content-Type": "application/json; charset=UTF-8",
          },
          body: JSON.stringify([{ Text: text }])
        });
        const data = await r.json();
        return data?.[0]?.translations?.[0]?.text ?? text;
      } else {
        const r = await fetch(LIBRE_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ q: text, source: "auto", target: to, format: "text" })
        });
        const data = await r.json();
        return data?.translatedText ?? text;
      }
    } catch (e) {
      console.warn("Translate error:", e);
      return text;
    }
  }

  let recognition = null;
  let listening = false;

  function setupRecognition() {
    if (!asrSupported) {
      statusEl.textContent = "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î Web Speech API. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ Chrome/Edge.";
      return;
    }
    recognition = new SR();
    recognition.lang = sourceSel.value;
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onstart = () => { statusEl.textContent = "üéß –°–ª—É—Ö–∞—é‚Ä¶ –ì–æ–≤–æ—Ä—ñ—Ç—å."; };
    recognition.onerror = (e) => { statusEl.textContent = "–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è: " + e.error; };
    recognition.onend = () => {
      if (listening) { recognition.start(); } else { statusEl.textContent = "–ó—É–ø–∏–Ω–µ–Ω–æ."; }
    };
    recognition.onresult = async (ev) => {
      const res = ev.results[ev.results.length - 1];
      if (!res || !res.isFinal) return;
      const text = res[0].transcript.trim();
      if (!text) return;
      orig.value += (orig.value ? "\\n" : "") + text;
      if (["—Å—Ç–æ–ø","stop","–∑—É–ø–∏–Ω–∏—Å—å"].includes(text.toLowerCase())) { stop(); return; }
      const translated = await translateText(text, targetSel.value);
      tran.value  += (tran.value ? "\\n" : "") + translated;
      statusEl.textContent = "‚úÖ –î–æ–¥–∞–Ω–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç";
    };
  }

  function start() {
    if (!recognition) setupRecognition();
    if (!recognition) return;
    listening = true;
    recognition.lang = sourceSel.value;
    try { recognition.start(); startBtn.disabled = true; stopBtn.disabled = false; } catch {}
  }
  function stop() {
    listening = false;
    if (recognition) { try { recognition.stop(); } catch {} }
    startBtn.disabled = false; stopBtn.disabled = true;
  }

  async function saveDocx() {
    const { Document, Packer, Paragraph, HeadingLevel } = window.docx;
    const doc = new Document({
      sections: [{
        properties: {},
        children: [
          new Paragraph({ text: "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è", heading: HeadingLevel.TITLE }),
          new Paragraph({ text: "" }),
          new Paragraph({ text: "–û—Ä–∏–≥—ñ–Ω–∞–ª", heading: HeadingLevel.HEADING_2 }),
          new Paragraph({ text: orig.value || "" }),
          new Paragraph({ text: "" }),
          new Paragraph({ text: "–ü–µ—Ä–µ–∫–ª–∞–¥", heading: HeadingLevel.HEADING_2 }),
          new Paragraph({ text: tran.value || "" }),
        ],
      }]
    });
    const blob = await Packer.toBlob(doc);
    const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
    saveAs(blob, `voice_to_text_${ts}.docx`);
  }

  startBtn.addEventListener("click", start);
  stopBtn .addEventListener("click", stop);
  clearBtn.addEventListener("click", () => { orig.value=""; tran.value=""; });
  saveBtn .addEventListener("click", saveDocx);
  sourceSel.addEventListener("change", () => { if (recognition) recognition.lang = sourceSel.value; });

  setupRecognition();
})();
</script>
</body>
</html>
